CREATE SEQUENCE dbname_serial

CREATE SEQUENCE appdef_serial

CREATE SEQUENCE lnk_app_grp_serial

CREATE SEQUENCE grp_version_serial

# a group of apps (versioned)
# there's a lack of foreign keys here for the versions because go database interface sucks
CREATE TABLE appgroup ( id integer PRIMARY KEY DEFAULT nextval('dbname_serial'), namespace varchar(100) not null, groupname varchar(100), deployedversion integer not null default 0, pendingversion integer not null default 0,unique(namespace,groupname)  )

CREATE TABLE appdef ( id integer PRIMARY KEY DEFAULT nextval('appdef_serial'), sourceurl varchar(255) NOT NULL, downloaduser varchar(255), downloadpw varchar(255),executable varchar(255) NOT NULL, repo varchar(255) NOT NULL, buildid integer not null, instances integer not null)

# groups are versioned..
CREATE TABLE group_version ( id integer PRIMARY KEY DEFAULT nextval('grp_version_serial'), group_id integer NOT NULL references appgroup(id)  )

# linking apps and group versions
CREATE TABLE lnk_app_grp ( id integer PRIMARY KEY DEFAULT nextval('lnk_app_grp_serial'), group_version_id integer NOT NULL references group_version(id), app_id integer NOT NULL references appdef(id), unique (group_version_id,app_id) )

# args for the apps
CREATE SEQUENCE args_serial

CREATE TABLE args ( id integer PRIMARY KEY DEFAULT nextval('args_serial'), argument varchar(100) NOT NULL, app_id integer NOT NULL references appdef(id) )